<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>8.1. Basics, Graphs, and Rules &#8212; MØD 0.10.0 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/haxes.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="8.2. Rule Composition" href="inc_rc.html" />
    <link rel="prev" title="8. Examples" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          MØD</a>
        <span class="navbar-text navbar-version pull-left"><b>0.10.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../genindex.html">Index</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">1. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../libmod/libmod.html">2. libMØD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pymod/pymod.html">3. PyMØD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../postmod/postmod.html">4. PostMØD (<code class="docutils literal notranslate"><span class="pre">mod_post</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modWrapper/modWrapper.html">5. The Wrapper Script (<code class="docutils literal notranslate"><span class="pre">mod</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataDesc/dataDesc.html">6. Data Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dgStrat/dgStrat.html">7. Derivation Graph Strategies</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">8. Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knownIssues.html">9. Known Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changes.html">10. Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">11. References</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">8.1. Basics, Graphs, and Rules</a><ul>
<li><a class="reference internal" href="#hello-world">8.1.1. Hello World</a></li>
<li><a class="reference internal" href="#graph-loading">8.1.2. Graph Loading</a></li>
<li><a class="reference internal" href="#printing-graphs-molecules">8.1.3. Printing Graphs/Molecules</a></li>
<li><a class="reference internal" href="#graph-interface">8.1.4. Graph Interface</a></li>
<li><a class="reference internal" href="#graph-morphisms">8.1.5. Graph Morphisms</a></li>
<li><a class="reference internal" href="#rule-loading">8.1.6. Rule Loading</a></li>
<li><a class="reference internal" href="#rule-morphisms">8.1.7. Rule Morphisms</a></li>
<li><a class="reference internal" href="#formose-grammar">8.1.8. Formose Grammar</a></li>
<li><a class="reference internal" href="#including-files">8.1.9. Including Files</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="index.html" title="Previous Chapter: 8. Examples"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 8. Examples</span>
    </a>
  </li>
  <li>
    <a href="inc_rc.html" title="Next Chapter: 8.2. Rule Composition"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">8.2. Rule Composition &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="basics-graphs-and-rules">
<h1><span class="section-number">8.1. </span>Basics, Graphs, and Rules<a class="headerlink" href="#basics-graphs-and-rules" title="Permalink to this headline">¶</a></h1>
<div class="section" id="hello-world">
<h2><span class="section-number">8.1.1. </span>Hello World<a class="headerlink" href="#hello-world" title="Permalink to this headline">¶</a></h2>
<p>These examples use the Python 3 interface for the software.
After each run a PDF summary is compiled.
The content can be specified via the Python script.</p>
<p><a class="reference external" href="https://cheminf-live.imada.sdu.dk/mod?example=000_hello.py">Explore in the playground</a>.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Normal printing to the terminal:</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">)</span>
<span class="c1"># Make some headers in the summary:</span>
<span class="n">postChapter</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
<span class="n">postSection</span><span class="p">(</span><span class="s2">&quot;World&quot;</span><span class="p">)</span>
<span class="c1"># Load a moleucle from a SMILES string:</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">smiles</span><span class="p">(</span><span class="s2">&quot;Cn1cnc2c1c(=O)n(c(=O)n2C)C&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Caffeine&quot;</span><span class="p">)</span>
<span class="c1"># Put a visualisation of the molecule in the summary:</span>
<span class="n">mol</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="graph-loading">
<h2><span class="section-number">8.1.2. </span>Graph Loading<a class="headerlink" href="#graph-loading" title="Permalink to this headline">¶</a></h2>
<p>Molecules are encoded as attributed graphs.
They can be loaded from SMILES strings, and in general any graph can be
loaded from a GML specification, or from the SMILES-like format GraphDFS.</p>
<p><a class="reference external" href="https://cheminf-live.imada.sdu.dk/mod?example=010_graphLoading.py">Explore in the playground</a>.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Load a graph from a SMILES string (only for molecule graphs):</span>
<span class="n">ethanol1</span> <span class="o">=</span> <span class="n">smiles</span><span class="p">(</span><span class="s2">&quot;CCO&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ethanol1&quot;</span><span class="p">)</span>
<span class="c1"># Load a graph from a SMILES-like format, called &quot;GraphDFS&quot;, but for general graphs:</span>
<span class="n">ethanol2</span> <span class="o">=</span> <span class="n">graphDFS</span><span class="p">(</span><span class="s2">&quot;[C]([H])([H])([H])[C]([H])([H])[O][H]&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ethanol2&quot;</span><span class="p">)</span>
<span class="c1"># The GraphDFS format also supports implicit hydrogens:</span>
<span class="n">ethanol3</span> <span class="o">=</span> <span class="n">graphDFS</span><span class="p">(</span><span class="s2">&quot;CCO&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ethanol3&quot;</span><span class="p">)</span>
<span class="c1"># The basic graph format is GML:</span>
<span class="n">ethanol4</span> <span class="o">=</span> <span class="n">graphGMLString</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;graph [</span>
<span class="s2">   node [ id 0 label &quot;C&quot; ]</span>
<span class="s2">   node [ id 1 label &quot;C&quot; ]</span>
<span class="s2">   node [ id 2 label &quot;O&quot; ]</span>
<span class="s2">   node [ id 3 label &quot;H&quot; ]</span>
<span class="s2">   node [ id 4 label &quot;H&quot; ]</span>
<span class="s2">   node [ id 5 label &quot;H&quot; ]</span>
<span class="s2">   node [ id 6 label &quot;H&quot; ]</span>
<span class="s2">   node [ id 7 label &quot;H&quot; ]</span>
<span class="s2">   node [ id 8 label &quot;H&quot; ]</span>
<span class="s2">   edge [ source 1 target 0 label &quot;-&quot; ]</span>
<span class="s2">   edge [ source 2 target 1 label &quot;-&quot; ]</span>
<span class="s2">   edge [ source 3 target 0 label &quot;-&quot; ]</span>
<span class="s2">   edge [ source 4 target 0 label &quot;-&quot; ]</span>
<span class="s2">   edge [ source 5 target 0 label &quot;-&quot; ]</span>
<span class="s2">   edge [ source 6 target 1 label &quot;-&quot; ]</span>
<span class="s2">   edge [ source 7 target 1 label &quot;-&quot; ]</span>
<span class="s2">   edge [ source 8 target 2 label &quot;-&quot; ]</span>
<span class="s2">]&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ethanol4&quot;</span><span class="p">)</span>
<span class="c1"># They really are all loading the same graph into different objects:</span>
<span class="k">assert</span> <span class="n">ethanol1</span><span class="o">.</span><span class="n">isomorphism</span><span class="p">(</span><span class="n">ethanol2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="n">ethanol1</span><span class="o">.</span><span class="n">isomorphism</span><span class="p">(</span><span class="n">ethanol3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="n">ethanol1</span><span class="o">.</span><span class="n">isomorphism</span><span class="p">(</span><span class="n">ethanol4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="c1"># and they can be visualised:</span>
<span class="n">ethanol1</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
<span class="c1"># All loaded graphs are added to a list &#39;inputGraphs&#39;:</span>
<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">inputGraphs</span><span class="p">:</span>
   <span class="n">g</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="printing-graphs-molecules">
<h2><span class="section-number">8.1.3. </span>Printing Graphs/Molecules<a class="headerlink" href="#printing-graphs-molecules" title="Permalink to this headline">¶</a></h2>
<p>The visualisation of graphs can be “prettified” using special printing
options.
The changes can make the graphs look like normal molecule visualisations.</p>
<p><a class="reference external" href="https://cheminf-live.imada.sdu.dk/mod?example=011_graphPrinting.py">Explore in the playground</a>.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Our test graph, representing the molecule caffeine:</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">smiles</span><span class="p">(</span><span class="s1">&#39;Cn1cnc2c1c(=O)n(c(=O)n2C)C&#39;</span><span class="p">)</span>
<span class="c1"># ;ake an object to hold our settings:</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">GraphPrinter</span><span class="p">()</span>
<span class="c1"># First try visualising without any prettifications:</span>
<span class="n">p</span><span class="o">.</span><span class="n">disableAll</span><span class="p">()</span>
<span class="n">g</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="c1"># Now make chemical edges look like bonds, and put colour on atoms.</span>
<span class="c1"># Also put the &quot;charge&quot; part of vertex labels in superscript:</span>
<span class="n">p</span><span class="o">.</span><span class="n">edgesAsBonds</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">p</span><span class="o">.</span><span class="n">raiseCharges</span><span class="o">=</span><span class="kc">True</span>
<span class="n">p</span><span class="o">.</span><span class="n">withColour</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">g</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="c1"># We can also &quot;collapse&quot; normal hydrogen atoms into the neighbours,</span>
<span class="c1"># and just show a count:</span>
<span class="n">p</span><span class="o">.</span><span class="n">collapseHydrogens</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">g</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="c1"># And finally we can make &quot;internal&quot; carbon atoms simple lines:</span>
<span class="n">p</span><span class="o">.</span><span class="n">simpleCarbons</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">g</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="c1"># There are also options for adding indices to the vertices,</span>
<span class="c1"># and modify the rendering of labels and edges:</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">GraphPrinter</span><span class="p">()</span>
<span class="n">p2</span><span class="o">.</span><span class="n">disableAll</span><span class="p">()</span>
<span class="n">p2</span><span class="o">.</span><span class="n">withTexttt</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">p2</span><span class="o">.</span><span class="n">thick</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">p2</span><span class="o">.</span><span class="n">withIndex</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># We can actually print two different versions at the same time:</span>
<span class="n">g</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="graph-interface">
<h2><span class="section-number">8.1.4. </span>Graph Interface<a class="headerlink" href="#graph-interface" title="Permalink to this headline">¶</a></h2>
<p>Graph objects have a full interface to access individual vertices and
edges.
The attributes of vertices and edges can be accessed both in their raw
string form, and as their chemical counterpart (if they have one).</p>
<p><a class="reference external" href="https://cheminf-live.imada.sdu.dk/mod?example=012_graphInterface.py">Explore in the playground</a>.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">graphDFS</span><span class="p">(</span><span class="s2">&quot;[R]</span><span class="si">{x}</span><span class="s2">C([O-])CC=O&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|V| =&quot;</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">numVertices</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|E| =&quot;</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">numEdges</span><span class="p">)</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v</span><span class="si">%d</span><span class="s2">: label=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">stringLabel</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">as molecule: atomId=</span><span class="si">%d</span><span class="s2">, charge=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">atomId</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">charge</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">is oxygen?&quot;</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">atomId</span> <span class="o">==</span> <span class="n">AtomIds</span><span class="o">.</span><span class="n">Oxygen</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">d(v) =&quot;</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">degree</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">incidentEdges</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">neighbour:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;(v</span><span class="si">%d</span><span class="s2">, v</span><span class="si">%d</span><span class="s2">): label=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">stringLabel</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
   <span class="k">try</span><span class="p">:</span>
      <span class="n">bt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">bondType</span><span class="p">)</span>
   <span class="k">except</span> <span class="n">LogicError</span><span class="p">:</span>
      <span class="n">bt</span> <span class="o">=</span> <span class="s2">&quot;Invalid&quot;</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">as molecule: bondType=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">bt</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">is double bond?&quot;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">bondType</span> <span class="o">==</span> <span class="n">BondType</span><span class="o">.</span><span class="n">Double</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="graph-morphisms">
<h2><span class="section-number">8.1.5. </span>Graph Morphisms<a class="headerlink" href="#graph-morphisms" title="Permalink to this headline">¶</a></h2>
<p>Graph objects have methods for finding morphisms with the VF2 algorithms
for isomorphism and monomorphism.
We can therefore easily detect isomorphic graphs, count automorphisms,
and search for substructures.</p>
<p><a class="reference external" href="https://cheminf-live.imada.sdu.dk/mod?example=013_graphMorphisms.py">Explore in the playground</a>.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">mol1</span> <span class="o">=</span> <span class="n">smiles</span><span class="p">(</span><span class="s2">&quot;CC(C)CO&quot;</span><span class="p">)</span>
<span class="n">mol2</span> <span class="o">=</span> <span class="n">smiles</span><span class="p">(</span><span class="s2">&quot;C(CC)CO&quot;</span><span class="p">)</span>
<span class="c1"># Check if there is just one isomorphism between the graphs:</span>
<span class="n">isomorphic</span> <span class="o">=</span> <span class="n">mol1</span><span class="o">.</span><span class="n">isomorphism</span><span class="p">(</span><span class="n">mol2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Isomorphic?&quot;</span><span class="p">,</span> <span class="n">isomorphic</span><span class="p">)</span>
<span class="c1"># Find the number of automorphisms in the graph,</span>
<span class="c1"># by explicitly enumerating all of them:</span>
<span class="n">numAutomorphisms</span> <span class="o">=</span> <span class="n">mol1</span><span class="o">.</span><span class="n">isomorphism</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">maxNumMatches</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">30</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|Aut(G)| =&quot;</span><span class="p">,</span> <span class="n">numAutomorphisms</span><span class="p">)</span>
<span class="c1"># Let&#39;s count the number of methyl groups:</span>
<span class="n">methyl</span> <span class="o">=</span> <span class="n">smiles</span><span class="p">(</span><span class="s2">&quot;[CH3]&quot;</span><span class="p">)</span>
<span class="c1"># The symmetry of the group it self should not be counted,</span>
<span class="c1"># so find the size of the automorphism group of methyl.</span>
<span class="n">numAutMethyl</span> <span class="o">=</span> <span class="n">methyl</span><span class="o">.</span><span class="n">isomorphism</span><span class="p">(</span><span class="n">methyl</span><span class="p">,</span> <span class="n">maxNumMatches</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">30</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|Aut(methyl)|&quot;</span><span class="p">,</span> <span class="n">numAutMethyl</span><span class="p">)</span>
<span class="c1"># Now find the number of methyl matches,</span>
<span class="n">numMono</span> <span class="o">=</span> <span class="n">methyl</span><span class="o">.</span><span class="n">monomorphism</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">maxNumMatches</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">30</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#monomorphisms =&quot;</span><span class="p">,</span> <span class="n">numMono</span><span class="p">)</span>
<span class="c1"># and divide by the symmetries of methyl.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#methyl groups =&quot;</span><span class="p">,</span> <span class="n">numMono</span> <span class="o">/</span> <span class="n">numAutMethyl</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="rule-loading">
<h2><span class="section-number">8.1.6. </span>Rule Loading<a class="headerlink" href="#rule-loading" title="Permalink to this headline">¶</a></h2>
<p>Rules must be specified in GML format.</p>
<p><a class="reference external" href="https://cheminf-live.imada.sdu.dk/mod?example=030_ruleLoading.py">Explore in the playground</a>.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># A rule (L &lt;- K -&gt; R) is specified by three graph fragments:</span>
<span class="c1"># left, context, and right</span>
<span class="n">destroyVertex</span> <span class="o">=</span> <span class="n">ruleGMLString</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;rule [</span>
<span class="s2">   left [</span>
<span class="s2">      node [ id 1 label &quot;A&quot; ]</span>
<span class="s2">   ]</span>
<span class="s2">]&quot;&quot;&quot;</span><span class="p">)</span>
<span class="n">createVertex</span> <span class="o">=</span> <span class="n">ruleGMLString</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;rule [</span>
<span class="s2">   right [</span>
<span class="s2">      node [ id 1 label &quot;A&quot; ]</span>
<span class="s2">   ]</span>
<span class="s2">]&quot;&quot;&quot;</span><span class="p">)</span>
<span class="n">identity</span> <span class="o">=</span> <span class="n">ruleGMLString</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;rule [</span>
<span class="s2">   context [</span>
<span class="s2">      node [ id 1 label &quot;A&quot; ]</span>
<span class="s2">   ]</span>
<span class="s2">]&quot;&quot;&quot;</span><span class="p">)</span>
<span class="c1"># A vertex/edge can change label:</span>
<span class="n">labelChange</span> <span class="o">=</span> <span class="n">ruleGMLString</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;rule [</span>
<span class="s2">   left [</span>
<span class="s2">      node [ id 1 label &quot;A&quot; ]</span>
<span class="s2">      edge [ source 1 target 2 label &quot;A&quot; ]</span>
<span class="s2">   ]</span>
<span class="s2">   # GML can have Python-style line comments too</span>
<span class="s2">   context [</span>
<span class="s2">      node [ id 2 label &quot;Q&quot; ]</span>
<span class="s2">   ]</span>
<span class="s2">   right [</span>
<span class="s2">      node [ id 1 label &quot;B&quot; ]</span>
<span class="s2">      edge [ source 1 target 2 label &quot;B&quot; ]</span>
<span class="s2">   ]</span>
<span class="s2">]&quot;&quot;&quot;</span><span class="p">)</span>
<span class="c1"># A chemical rule should probably not destroy and create vertices:</span>
<span class="n">ketoEnol</span> <span class="o">=</span> <span class="n">ruleGMLString</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;rule [</span>
<span class="s2">   left [</span>
<span class="s2">      edge [ source 1 target 4 label &quot;-&quot; ]</span>
<span class="s2">      edge [ source 1 target 2 label &quot;-&quot; ]</span>
<span class="s2">      edge [ source 2 target 3 label &quot;=&quot; ]</span>
<span class="s2">   ]   </span>
<span class="s2">   context [</span>
<span class="s2">      node [ id 1 label &quot;C&quot; ]</span>
<span class="s2">      node [ id 2 label &quot;C&quot; ]</span>
<span class="s2">      node [ id 3 label &quot;O&quot; ]</span>
<span class="s2">      node [ id 4 label &quot;H&quot; ]</span>
<span class="s2">   ]   </span>
<span class="s2">   right [</span>
<span class="s2">      edge [ source 1 target 2 label &quot;=&quot; ]</span>
<span class="s2">      edge [ source 2 target 3 label &quot;-&quot; ]</span>
<span class="s2">      edge [ source 3 target 4 label &quot;-&quot; ]</span>
<span class="s2">   ]   </span>
<span class="s2">]&quot;&quot;&quot;</span><span class="p">)</span>
<span class="c1"># Rules can be printed, but label changing edges are not visualised in K:</span>
<span class="n">ketoEnol</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
<span class="c1"># Add with custom options, like graphs:</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">GraphPrinter</span><span class="p">()</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">GraphPrinter</span><span class="p">()</span>
<span class="n">p1</span><span class="o">.</span><span class="n">disableAll</span><span class="p">()</span>
<span class="n">p1</span><span class="o">.</span><span class="n">withTexttt</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">p1</span><span class="o">.</span><span class="n">withIndex</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">p2</span><span class="o">.</span><span class="n">setReactionDefault</span><span class="p">()</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">inputRules</span><span class="p">:</span>
   <span class="n">p</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
<span class="c1"># Be careful with printing options and non-existing implicit hydrogens:</span>
<span class="n">p1</span><span class="o">.</span><span class="n">disableAll</span><span class="p">()</span>
<span class="n">p1</span><span class="o">.</span><span class="n">edgesAsBonds</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">p2</span><span class="o">.</span><span class="n">setReactionDefault</span><span class="p">()</span>
<span class="n">p2</span><span class="o">.</span><span class="n">simpleCarbons</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># !!</span>
<span class="n">ketoEnol</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="rule-morphisms">
<h2><span class="section-number">8.1.7. </span>Rule Morphisms<a class="headerlink" href="#rule-morphisms" title="Permalink to this headline">¶</a></h2>
<p>Rule objects, like graph objects, have methods for finding morphisms with
the VF2 algorithms for isomorphism and monomorphism.
We can therefore easily detect isomorphic rules,
and decide if one rule is at least as specific/general as another.</p>
<p><a class="reference external" href="https://cheminf-live.imada.sdu.dk/mod?example=031_ruleMorphisms.py">Explore in the playground</a>.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># A rule with no extra context:</span>
<span class="n">small</span> <span class="o">=</span> <span class="n">ruleGMLString</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;rule [</span>
<span class="s2">   ruleID &quot;Small&quot;</span>
<span class="s2">   left [</span>
<span class="s2">      node [ id 1 label &quot;H&quot; ]</span>
<span class="s2">      node [ id 2 label &quot;O&quot; ]</span>
<span class="s2">      edge [ source 1 target 2 label &quot;-&quot; ]</span>
<span class="s2">   ]</span>
<span class="s2">   right [</span>
<span class="s2">      node [ id 1 label &quot;H+&quot; ]</span>
<span class="s2">      node [ id 2 label &quot;O-&quot; ]</span>
<span class="s2">   ]</span>
<span class="s2">]&quot;&quot;&quot;</span><span class="p">)</span>
<span class="c1"># The same rule, with a bit of context:</span>
<span class="n">large</span> <span class="o">=</span> <span class="n">ruleGMLString</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;rule [</span>
<span class="s2">   ruleID &quot;Large&quot;</span>
<span class="s2">   left [</span>
<span class="s2">      node [ id 1 label &quot;H&quot; ]</span>
<span class="s2">      node [ id 2 label &quot;O&quot; ]</span>
<span class="s2">      edge [ source 1 target 2 label &quot;-&quot; ]</span>
<span class="s2">   ]</span>
<span class="s2">   context [</span>
<span class="s2">      node [ id 3 label &quot;C&quot; ]</span>
<span class="s2">      edge [ source 2 target 3 label &quot;-&quot; ]</span>
<span class="s2">   ]</span>
<span class="s2">   right [</span>
<span class="s2">      node [ id 1 label &quot;H+&quot; ]</span>
<span class="s2">      node [ id 2 label &quot;O-&quot; ]</span>
<span class="s2">   ]</span>
<span class="s2">]&quot;&quot;&quot;</span><span class="p">)</span>
<span class="n">isomorphic</span> <span class="o">=</span> <span class="n">small</span><span class="o">.</span><span class="n">isomorphism</span><span class="p">(</span><span class="n">large</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Isomorphic?&quot;</span><span class="p">,</span> <span class="n">isomorphic</span><span class="p">)</span>
<span class="n">atLeastAsGeneral</span> <span class="o">=</span> <span class="n">small</span><span class="o">.</span><span class="n">monomorphism</span><span class="p">(</span><span class="n">large</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;At least as general?&quot;</span><span class="p">,</span> <span class="n">atLeastAsGeneral</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="formose-grammar">
<h2><span class="section-number">8.1.8. </span>Formose Grammar<a class="headerlink" href="#formose-grammar" title="Permalink to this headline">¶</a></h2>
<p>The graph grammar modelling the formose chemistry.</p>
<p><a class="reference external" href="https://cheminf-live.imada.sdu.dk/mod?example=050_formoseGrammar.py">Explore in the playground</a>.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">formaldehyde</span> <span class="o">=</span> <span class="n">smiles</span><span class="p">(</span><span class="s2">&quot;C=O&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Formaldehyde&quot;</span><span class="p">)</span>
<span class="n">glycolaldehyde</span> <span class="o">=</span> <span class="n">smiles</span><span class="p">(</span> <span class="s2">&quot;OCC=O&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Glycolaldehyde&quot;</span><span class="p">)</span>
<span class="n">ketoEnolGML</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;rule [</span>
<span class="s2">   ruleID &quot;Keto-enol isomerization&quot; </span>
<span class="s2">   left [</span>
<span class="s2">      edge [ source 1 target 4 label &quot;-&quot; ]</span>
<span class="s2">      edge [ source 1 target 2 label &quot;-&quot; ]</span>
<span class="s2">      edge [ source 2 target 3 label &quot;=&quot; ]</span>
<span class="s2">   ]   </span>
<span class="s2">   context [</span>
<span class="s2">      node [ id 1 label &quot;C&quot; ]</span>
<span class="s2">      node [ id 2 label &quot;C&quot; ]</span>
<span class="s2">      node [ id 3 label &quot;O&quot; ]</span>
<span class="s2">      node [ id 4 label &quot;H&quot; ]</span>
<span class="s2">   ]   </span>
<span class="s2">   right [</span>
<span class="s2">      edge [ source 1 target 2 label &quot;=&quot; ]</span>
<span class="s2">      edge [ source 2 target 3 label &quot;-&quot; ]</span>
<span class="s2">      edge [ source 3 target 4 label &quot;-&quot; ]</span>
<span class="s2">   ]   </span>
<span class="s2">]&quot;&quot;&quot;</span>
<span class="n">ketoEnol_F</span> <span class="o">=</span> <span class="n">ruleGMLString</span><span class="p">(</span><span class="n">ketoEnolGML</span><span class="p">)</span>
<span class="n">ketoEnol_B</span> <span class="o">=</span> <span class="n">ruleGMLString</span><span class="p">(</span><span class="n">ketoEnolGML</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">aldolAddGML</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;rule [</span>
<span class="s2">   ruleID &quot;Aldol Addition&quot;</span>
<span class="s2">   left [</span>
<span class="s2">      edge [ source 1 target 2 label &quot;=&quot; ]</span>
<span class="s2">      edge [ source 2 target 3 label &quot;-&quot; ]</span>
<span class="s2">      edge [ source 3 target 4 label &quot;-&quot; ]</span>
<span class="s2">      edge [ source 5 target 6 label &quot;=&quot; ]</span>
<span class="s2">   ]</span>
<span class="s2">   context [</span>
<span class="s2">      node [ id 1 label &quot;C&quot; ]</span>
<span class="s2">      node [ id 2 label &quot;C&quot; ]</span>
<span class="s2">      node [ id 3 label &quot;O&quot; ]</span>
<span class="s2">      node [ id 4 label &quot;H&quot; ]</span>
<span class="s2">      node [ id 5 label &quot;O&quot; ]</span>
<span class="s2">      node [ id 6 label &quot;C&quot; ]</span>
<span class="s2">   ]</span>
<span class="s2">   right [</span>
<span class="s2">      edge [ source 1 target 2 label &quot;-&quot; ]</span>
<span class="s2">      edge [ source 2 target 3 label &quot;=&quot; ]</span>
<span class="s2">      edge [ source 5 target 6 label &quot;-&quot; ]</span>

<span class="s2">      edge [ source 4 target 5 label &quot;-&quot; ]</span>
<span class="s2">      edge [ source 6 target 1 label &quot;-&quot; ]</span>
<span class="s2">   ]</span>
<span class="s2">]&quot;&quot;&quot;</span>
<span class="n">aldolAdd_F</span> <span class="o">=</span> <span class="n">ruleGMLString</span><span class="p">(</span><span class="n">aldolAddGML</span><span class="p">)</span>
<span class="n">aldolAdd_B</span> <span class="o">=</span> <span class="n">ruleGMLString</span><span class="p">(</span><span class="n">aldolAddGML</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="including-files">
<h2><span class="section-number">8.1.9. </span>Including Files<a class="headerlink" href="#including-files" title="Permalink to this headline">¶</a></h2>
<p>We can include other files (a la C/C++) to seperate functionality.</p>
<p><a class="reference external" href="https://cheminf-live.imada.sdu.dk/mod?example=051_fileInclusion.py">Explore in the playground</a>.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">include</span><span class="p">(</span><span class="s2">&quot;050_formoseGrammar.py&quot;</span><span class="p">)</span>
<span class="n">postSection</span><span class="p">(</span><span class="s2">&quot;Input Graphs&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">inputGraphs</span><span class="p">:</span>
   <span class="n">a</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
<span class="n">postSection</span><span class="p">(</span><span class="s2">&quot;Input Rules&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">inputRules</span><span class="p">:</span>
   <span class="n">a</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../_sources/examples/inc_basics.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2013-2020, Jakob Lykke Andersen.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.0+/60e55278.<br/>
    </p>
  </div>
</footer>
  </body>
</html>